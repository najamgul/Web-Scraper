{% extends "base.html" %}
{% block content %}
<h2>Scan Results</h2>

<div class="results-section">

    <!-- Classification -->
    <div class="card mb-3 p-3">
        <h3>Classification</h3>
        <p>{{ results.classification or "Unknown" }}</p>
    </div>

    <!-- VirusTotal -->
    <div class="card mb-3 p-3">
        <h3>VirusTotal</h3>
        {% if results.vt %}
            <pre style="white-space: pre-wrap; font-family: monospace; background:#0f172a; color:#e5e7eb; padding:12px; border-radius:8px;">
{{ results.vt | tojson(indent=2) }}
            </pre>
        {% else %}
            <p>No VirusTotal data available</p>
        {% endif %}
    </div>

    <!-- Passive Recon -->
    <div class="card mb-3 p-3">
        <h3>Passive Recon</h3>
        {% if results.passive %}
            <pre style="white-space: pre-wrap; font-family: monospace; background:#f9fafb; padding:12px; border-radius:8px;">
{{ results.passive }}
            </pre>
        {% else %}
            <p>No passive recon data available</p>
        {% endif %}
    </div>

    <!-- Active Recon -->
    <div class="card mb-3 p-3">
        <h3>Active Recon</h3>
        {% if results.active %}
            <pre style="white-space: pre-wrap; font-family: monospace; background:#f9fafb; padding:12px; border-radius:8px;">
{{ results.active }}
            </pre>
        {% else %}
            <p>No active recon data available</p>
        {% endif %}
    </div>

    <!-- âœ… Scraped Data (formatted cards) -->
    <div class="card mb-3 p-3">
        <h3>Scraped Data</h3>
        {% set scraped = results.scraped or [] %}
        {% if scraped %}
            <div class="grid gap-4">
                {% for item in scraped %}
                    <div class="card" style="padding:16px; border:1px solid #ddd; border-radius:8px; background:#f9fafb; margin-bottom:12px;">
                        <h4 style="margin:0; color:#1e3a8a;">
                            <a href="{{ item.url }}" target="_blank">{{ item.title }}</a>
                        </h4>
                        <p style="margin:6px 0; color:#374151;">{{ item.snippet }}</p>

                        {% if item.iocs %}
                        <details style="margin-top:8px;">
                            <summary style="cursor:pointer;">IOCs</summary>
                            <ul style="margin-left:16px; color:#111827;">
                                {% if item.iocs.urls %}
                                    <li><strong>URLs:</strong> {{ item.iocs.urls | join(", ") }}</li>
                                {% endif %}
                                {% if item.iocs.ips %}
                                    <li><strong>IPs:</strong> {{ item.iocs.ips | join(", ") }}</li>
                                {% endif %}
                                {% if item.iocs.hashes %}
                                    <li><strong>Hashes:</strong> {{ item.iocs.hashes | join(", ") }}</li>
                                {% endif %}
                            </ul>
                        </details>
                        {% endif %}

                        {% if item.content %}
                        <details style="margin-top:8px;">
                            <summary style="cursor:pointer;">Full Content</summary>
                            <pre style="max-height:200px; overflow:auto; white-space:pre-wrap; background:#0f172a; color:#e5e7eb; padding:8px; border-radius:6px;">
{{ item.content }}
                            </pre>
                        </details>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No scraped data found</p>
        {% endif %}
    </div>

</div>
{% endblock %}
