<!-- app/templates/results.html -->
{% extends "base.html" %}

{% block content %}
<h2>Scan Results</h2>

<div class="card">
    <h3>Input: {{ results.input }}</h3>
    <p>Type: {{ results.type }}</p>
    <p>Classification: 
        <strong style="color: {{ 'red' if results.classification == 'malicious' else 'green' }}">
            {{ results.classification }}
        </strong>
    </p>
</div>

<hr>

<h3>VirusTotal Report</h3>
<pre>{{ results.vt | tojson(indent=2) }}</pre>

<h3>Shodan Report</h3>
<pre>{{ results.shodan | tojson(indent=2) }}</pre>

<h3>Scraped Data</h3>
<pre>{{ results.scraped | tojson(indent=2) }}</pre>

<hr>

<h3>Classification Overview</h3>
<canvas id="classificationPie" width="300" height="300"></canvas>

<h3>VirusTotal Detections</h3>
<canvas id="vtBarChart" width="400" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ---------------- PIE CHART ----------------
const classificationData = {
    labels: ['Malicious', 'Benign'],
    datasets: [{
        data: [
            {{ 1 if results.classification == "malicious" else 0 }},
            {{ 1 if results.classification == "benign" else 0 }}
        ],
        backgroundColor: ['#ff4d4d', '#4caf50']
    }]
};

new Chart(document.getElementById('classificationPie'), {
    type: 'pie',
    data: classificationData
});

// ---------------- BAR CHART ----------------
{% set vt_stats = results.vt.get('last_analysis_stats') if results.vt and results.vt.get('last_analysis_stats') else {} %}
const vtLabels = Object.keys({{ vt_stats | tojson | safe }});
const vtValues = Object.values({{ vt_stats | tojson | safe }});

new Chart(document.getElementById('vtBarChart'), {
    type: 'bar',
    data: {
        labels: vtLabels,
        datasets: [{
            label: 'VirusTotal Detection Stats',
            data: vtValues,
            backgroundColor: '#2196f3'
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false }
        }
    }
});
</script>
{% endblock %}
